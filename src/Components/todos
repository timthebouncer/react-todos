import React from "react"

const { useState, useEffect } = React;
//React.useState, React.useEffect
//這裡是方法
function formatDate(d) {
  //d = createDate
  let HH = d.getHours();
  let mm = d.getMinutes();
  let ss = d.getSeconds();
  return HH + ":" + mm + ":" + ss;
}

function editHandler(props, setState, item) {
  console.log(item);
  // const { state } = props;
  item.status = false;
  //   console.log({ state });
  // setState([...item]);
}

function deleteHandler(props, setState, index) {
  //第一個參數可改成{state}
  const { state } = props;
  // props.state
  setState([...state.slice(0, index), ...state.slice(index + 1, state.length)]);
  // setState(state.slice(0, index).concat(state.slice(index + 1, state.length)))
}
//以上是方法
let id = 1;
function InputText(props) {
  const [state, setState] = useState("");
  // id++;
  return (
    <div>
      代辦事項
      <input
        type="text"
        value={state}
        onChange={function (e) {
          setState(e.target.value);
        }}
        placeholder="請輸入代辦事項"
      />
      <button
        onClick={() => {
          props.setState([
            ...props.state,
            { id: ++id, name: state, createDate: new Date() }
          ]);
          setState("");
        }}
      >
        送出
      </button>
    </div>
  );
}

function Table(props) {
  return (
    <div>
      <table>
        <thead>
        <tr>
          <th>序</th>
          <th>名字</th>
          <th>新增日期</th>
          <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {props.state.map((item, index) => (
          <tr key={item.id}>
            <td>{index + 1}</td>
            {item.status ? (
              <td onClick={() => editHandler(props, props.setState, item)}>
                {item.name}
              </td>
            ) : (
              <input
                type="text"
                value={item.name}
                onChange={function (e) {
                  props.setState(e.target.value);
                }}
              />
            )}
            <td>{formatDate(item.createDate)}</td>
            <span onClick={() => deleteHandler(props, props.setState, index)}>
                刪除
              </span>
          </tr>
        ))}
        </tbody>
      </table>
    </div>
  );
}

const header = [{ id: 1, name: "frank", createDate: new Date(), status: true }];

function Todos(props) {
  const [state, setState] = useState([]);
  const [disable, setDisable] = useState(true);
  useEffect(
    function () {
      setTimeout(function () {
        setState(header);
      }, 300);
      //能夠引起useEffect的依賴
    },
    []
  );

  return (
    <div>
      <button onClick={() => setDisable(!disable)}>
        {disable ? "禁用" : "啟用"}
      </button>

      <InputText setState={setState} state={state} />
      <Table state={state} setState={setState} />
    </div>
  );
}

ReactDOM.render(<Todos header={header} />, document.getElementById("root"));
